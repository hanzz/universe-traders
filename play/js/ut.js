function Overlay(a){PIXI.Graphics.call(this),this.width=Main.WIDTH,this.height=Main.HEIGHT,this.position.x=0,this.position.y=0,this.universe=a,this.shots=[],this.showed=!1}function Universe(){var a=PIXI.Texture.fromImage("resources/universe.png");PIXI.TilingSprite.call(this,a,Main.WIDTH,Main.HEIGHT),this.overlay=new Overlay(this),this.ship=new PlayerShip,this.addChild(this.ship),this.panel=new Panel(this,this.ship),this.addChild(this.panel),this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,this.panel.height,Main.WIDTH,Main.HEIGHT-this.panel.height),this.objManager=new ObjectManager(this),this.objManager.onObjectsLoaded=this.objectsLoaded.bind(this),this.stopMove=!1,this.orbitTimer=0,this.statsTimer=0,this.currentObject=null,this.objectToMove=null,radio("dialogStarted").subscribe(this.stopMovement.bind(this)),radio("dialogFinished").subscribe(this.continueMovement.bind(this)),radio("objectVisited").subscribe(this.stopMovement.bind(this)),radio("objectVisitFinished").subscribe(this.continueMovement.bind(this)),this.reset()}function Ship(a,b){this.stayingTexture="string"==typeof a?PIXI.Texture.fromImage(a):a,this.flyingTexture="string"==typeof b?PIXI.Texture.fromImage(b):b,PIXI.Sprite.call(this,this.stayingTexture),this.pivot.x=this.width/2,this.pivot.y=this.height/2,this.position.x=Main.WIDTH/2,this.position.y=Main.HEIGHT/2,this.attack=.1,this.defense=.1,this.reset()}function PlayerShip(){Ship.call(this,"resources/ship.png","resources/ship_moving.png"),this.name="ship",this.reset()}function IntelligentShip(a,b,c,d,e,f,g,h,i,j,k,l,m){for(Ship.call(this,d,d),this.attack=k,this.defense=l,this.objManager=a,this.collideWidth=.8*this.width,this.collideHeight=.8*this.height,this.origX=e,this.origY=f,this.mapX=e,this.mapY=f,this.staged=!1,this.name=b,this.type=c,this.items=g,this.prices=h,this.demand={},this.speed=i,this.waypoints=j,this.waypoint=0,this.movingX=0,this.movingY=0,this.xVel=0,this.yVel=0,this.addX=0,this.addY=0,this.cycles=0,this.mapText=null,this.disableMovement=!1,this.closeShips=[],this.shootTimer=100*Math.random()>>0,this.respawnTime=m,this.respawnTimer=0;this.prices.length!=Item.LAST_CATEGORY;)this.prices[this.prices.length]=1;radio("objectTouched").subscribe(this.handleObjectTouched.bind(this)),radio("objectLeft").subscribe(this.handleObjectLeft.bind(this)),this.reset()}function Panel(a,b){var c=PIXI.Texture.fromImage("resources/panel.png");PIXI.Sprite.call(this,c),this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,730,this.height),this.ship=b,this.universe=a,this.disableVisit=!1;var d=PIXI.Texture.fromImage("resources/dot.png");this.fuel=new PIXI.Sprite(d),this.fuel.position.x=735,this.fuel.position.y=25,this.fuel.height=20,this.fuel.width=80,this.addChild(this.fuel),this.food=new PIXI.Sprite(d),this.food.position.x=835,this.food.position.y=25,this.food.height=20,this.food.width=80,this.addChild(this.food),this.sanity=new PIXI.Sprite(d),this.sanity.position.x=935,this.sanity.position.y=25,this.sanity.height=20,this.sanity.width=80,this.addChild(this.sanity),this.visit=new PIXI.Text("",{font:"25px Snippet",fill:"white",align:"left"}),this.visit.position.x=20,this.visit.position.y=15,this.addChild(this.visit),this.credit=new PIXI.Text(this.ship.credit,{font:"20px Snippet",fill:"white",align:"center"}),this.credit.position.x=650,this.credit.position.y=25,this.addChild(this.credit),this.coordinates=new PIXI.Text("",{font:"14px Snippet",fill:"white",align:"center"}),this.coordinates.position.x=10,this.coordinates.position.y=55,this.addChild(this.coordinates),this.object=null,radio("objectTouched").subscribe(this.handleObjectTouched.bind(this)),radio("objectLeft").subscribe(this.handleObjectLeft.bind(this)),radio("creditChanged").subscribe(this.updateCredit.bind(this)),radio("dialogStarted").subscribe(this.disableVisiting.bind(this)),radio("dialogFinished").subscribe(this.enableVisiting.bind(this))}function MapObject(){}function CelestialBody(a,b,c,d,e,f,g,h,i,j,k){var l=PIXI.Texture.fromImage(d);for(PIXI.Sprite.call(this,l),this.pivot.x=this.width/2,this.pivot.y=this.height/2,this.collideWidth=.8*this.width,this.collideHeight=.8*this.height,this.mapX=e,this.mapY=f,this.staged=!1,this.name=b,this.type=c,this.items=g,this.prices=h,this.demand={},this.a=i*Universe.MAP_POINT_SIZE,this.b=j*Universe.MAP_POINT_SIZE,this.speed=k,this.posParam=0,this.parentObject=null,this.childrenObjects=[],this.staggedChildren=0,this.shipObject=null,this.movingX=0,this.movingY=0,this.xVel=0,this.yVel=0,this.addX=0,this.addY=0,this.prevX=this.a*Math.cos(this.posParam),this.prevY=this.b*Math.sin(this.posParam),this.cycles=0,this.mapText=null;this.prices.length!=Item.LAST_CATEGORY;)this.prices[this.prices.length]=1;this.reset()}function ObjectManager(a){this.universe=a,this.objects=[],this.staged=[],this.boundToStaged=[],this.centralObject=null,this.ships=[]}function Inventory(a,b){var c=PIXI.Texture.fromImage("resources/inventory.png");PIXI.Sprite.call(this,c),this.width=448,this.height=448,this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,this.width,this.height),this.position.x=544,this.position.y=90,this.showed=!1,this.ship=a,this.itemManager=b,this.itemManager.onItemsLoaded=this.itemsLoaded.bind(this),this.inventory=new Array(7);for(var d=0;7>d;d++)this.inventory[d]=new Array(7)}function PlanetInventory(a,b,c){var d=PIXI.Texture.fromImage("resources/planet.png");PIXI.Sprite.call(this,d),this.width=448,this.height=448,this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,this.width,this.height),this.position.x=32,this.position.y=90,this.showed=!1,this.ship=a,this.itemManager=b,this.dialogManager=c,this.planet=null,this.inventory=new Array(7);for(var e=0;7>e;e++)this.inventory[e]=new Array(7)}function Item(a,b,c,d,e,f,g,h,i,j,k){this.id=a,this.texture=d,this.name=b,this.type=c,this.speed=f,this.fuel=g,this.price=e,this.sanity=h,this.food=i,this.attack=j,this.defense=k}function ItemManager(){this.items=[]}function ItemSprite(a){var b=PIXI.Texture.fromImage(a.texture);PIXI.Sprite.call(this,b),this.width=64,this.height=64,this.item=a}function ItemInfo(a,b,c,d,e,f){var g=PIXI.Texture.fromImage("resources/iteminfo.png");PIXI.Sprite.call(this,g),this.width=351,this.height=257,this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,this.width,this.height),this.position.x=Main.CENTER_X/2-this.width/2,this.position.y=Main.CENTER_Y-this.height/2,this.to=f,this.from=e,this.ship=b,this.item=c,this.itemSprite=a.createSprite(c.id),this.addChild(this.itemSprite);var h=new PIXI.Text(c.name,{font:"20px Snippet",fill:"white"});h.position.x=70,h.position.y=25,this.addChild(h);var i=50;if(c.speed){var j=new PIXI.Text("Speed: "+(c.speed>0?"+":"-")+c.speed,{font:"20px Snippet",fill:c.speed>0?"lightgreen":"red"});j.position.x=70,j.position.y=i,i+=25,this.addChild(j)}if(c.fuel){var k=new PIXI.Text("Fuel consumption: "+(c.fuel>0?"+":"-")+c.fuel,{font:"20px Snippet",fill:c.fuel>0?"red":"lightgreen"});k.position.x=70,k.position.y=i,i+=25,this.addChild(k)}if(c.sanity){var l=new PIXI.Text("Sanity: "+(c.sanity>0?"+":"-")+c.sanity,{font:"20px Snippet",fill:c.sanity<0?"lightgreen":"red"});l.position.x=70,l.position.y=i,i+=25,this.addChild(l)}if(c.food){var m=new PIXI.Text("Food: "+(c.food>0?"+":"-")+c.food,{font:"20px Snippet",fill:c.food<0?"lightgreen":"red"});m.position.x=70,m.position.y=i,i+=25,this.addChild(m)}if(c.attack){var n=new PIXI.Text("Damage: +"+c.attack,{font:"20px Snippet",fill:"lightgreen"});n.position.x=70,n.position.y=i,i+=25,this.addChild(n)}if(c.defense){var o=new PIXI.Text("Defense: +"+c.defense,{font:"20px Snippet",fill:"lightgreen"});o.position.x=70,o.position.y=i,i+=25,this.addChild(o)}var p=c.price;p=this.from.correctPrice(c,p,!1),this.to&&(p=this.to.correctPrice(c,p,!0));var q=new PIXI.Text("Price: "+(p>0?p:-p),{font:"20px Snippet",fill:"white"});q.position.x=70,q.position.y=200,i+=25,this.addChild(q);var r=new PIXI.Text("Close",{font:"25px Snippet",fill:"white"});r.position.x=262-r.width/2,r.position.y=230,this.addChild(r),(!this.to||this.ship.credit+p>=0)&&(d=new PIXI.Text(d,{font:"25px Snippet",fill:"white"}),d.position.x=87-d.width/2,d.position.y=230,this.addChild(d))}function Map(a){PIXI.Graphics.call(this),this.width=896,this.height=448,this.position.x=32,this.position.y=90,this.showed=!1,this.universe=a}function AssetsLoader(a,b){var c=["resources/4.png","resources/jupiter.png","resources/mercury.png","resources/moon.png","resources/mars.png","resources/venus.png","resources/panel.png","resources/iteminfo.png","resources/2.png","resources/inventory.png","resources/3.png","resources/universe.png","resources/sun.png","resources/earth.png","resources/planet.png","resources/ship.png","resources/neptune.png","resources/uranus.png","resources/ship_moving.png","resources/dot.png","resources/1.png","resources/map.png","resources/0.png","resources/saturn.png","resources/menu.png","resources/dialog.png","resources/ship2.png","resources/ship_enemy1.png"];PIXI.AssetLoader.call(this,c),this.stage=b,this.renderer=a;var d=PIXI.Texture.fromImage("resources/dot.png");this.progressBar=new PIXI.Sprite(d),this.progressBar.x=Main.CENTER_X-100,this.progressBar.y=Main.CENTER_Y-15,this.progressBar.height=30,this.progressBar.width=1,this.stage.addChild(this.progressBar),this.onProgress=this.assetLoaded.bind(this,c.length)}function Menu(a){var b=PIXI.Texture.fromImage("resources/menu.png");PIXI.Sprite.call(this,b),this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,this.width,this.height),this.position.x=Main.CENTER_X-this.width/2,this.position.y=Main.CENTER_Y-this.height/2,this.showed=!1,this.stg=a}function DialogObject(a,b,c){this.once=b,this.face=a,this.dialog=c}function DialogManager(a,b,c){this.stage=a,this.inventory=b,this.objManager=c,this.currentDialog=null,this.currentName="",this.dialogs={},this.eventToDialog={},this.objectToDialog={},radio("objectTouched").subscribe(this.handleObjectTouched.bind(this)),radio("objectLeft").subscribe(this.handleObjectLeft.bind(this)),radio("objectDestroyed").subscribe(this.handleObjectDestroyed.bind(this))}function Dialog(a,b,c,d){var e=PIXI.Texture.fromImage("resources/dialog.png");PIXI.Sprite.call(this,e),this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,this.width,this.height),this.position.x=0,this.position.y=Main.HEIGHT-this.height,a?(e=PIXI.Texture.fromImage(a),this.face=new PIXI.Sprite(e),this.face.position.x=0,this.face.position.y=0,this.face.width=64,this.face.height=64):this.face=null,this.inventory=c,this.objManager=d,this.root=null,this.rootKeys=[],this.dialog=b}function Statistics(a,b){PIXI.Graphics.call(this),this.width=448,this.height=448,this.position.x=224,this.position.y=90,this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,448,448),this.ship=a,this.stg=b,this.showed=!1,radio("showStatistics").subscribe(this.show.bind(this))}function Quests(a){PIXI.Graphics.call(this),this.width=560,this.height=560,this.position.x=112,this.position.y=90,this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,560,560),this.stg=a,this.showed=!1,radio("showQuests").subscribe(this.show.bind(this))}function resize(){canvas=document.getElementById("game-canvas");var a,b=window.innerHeight,c=window.innerWidth,d=c-20,e=b-20;b>c?(a=canvas.height/canvas.width,e=a*c):(a=canvas.width/canvas.height,d=b*a),canvas.style.width=d+"px",canvas.style.height=e+"px"}function Main(){this.stage=new PIXI.Stage(0,!0);var a={view:document.getElementById("game-canvas"),resolution:1};this.renderer=new PIXI.autoDetectRenderer(Main.WIDTH,Main.HEIGHT,a),this.stop=!1,this.itemInfo=null,this.msg=null,this.lastSaveTime=Date.now(),this.tickRate=Date.now(),window.addEventListener("resize",resize,!1),resize(),this.loadAssets(),radio("restartGame").subscribe(this.restartGame.bind(this))}Overlay.constructor=Overlay,Overlay.prototype=Object.create(PIXI.Graphics.prototype),Overlay.prototype.laserShot=function(a,b,c){var d=c*a.attack*(1-b.defense)>>0;b.fuel-=d,b.fuel=b.fuel>>0,b.fuel<=0&&b.destroy();var e=new PIXI.Text("-"+d,{font:"24px Snippet",fill:"white",align:"left"});this.addChild(e),this.shots[this.shots.length]=[a,b,c,e],this.showed||(this.universe.addChild(this),this.showed=!0)},Overlay.prototype.update=function(){if(this.showed){this.clear();for(var a=0;a<this.shots.length;a++){var b=this.shots[a][0],c=this.shots[a][1];this.lineStyle(2,16711680,1),this.moveTo(b.position.x,b.position.y),this.lineTo(c.position.x,c.position.y),this.lineStyle(1,26112,1),this.beginFill(21760,.2),this.drawCircle(c.position.x,c.position.y,c.width/2),this.endFill(),this.shots[a][3].position.x=c.position.x+c.width/2,this.shots[a][3].position.y=c.position.y-b.height/2,this.shots[a][2]-=1,this.shots[a][2]<=0&&(this.removeChild(this.shots[a][3]),this.shots.splice(a,1),a-=1,0===this.shots.length&&(this.universe.removeChild(this),this.showed=!1))}}},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Overlay),Universe.constructor=Universe,Universe.prototype=Object.create(PIXI.TilingSprite.prototype),Universe.MAP_POINT_SIZE=15,Universe.prototype.stopMovement=function(){this.stopMove=!0,(this.xVel||this.yVel)&&(this.moving_x=(this.tilePositionX+Main.WIDTH/2)/Universe.MAP_POINT_SIZE>>0,this.moving_y=(this.tilePositionY+Main.HEIGHT/2)/Universe.MAP_POINT_SIZE>>0)},Universe.prototype.continueMovement=function(){this.stopMove=!1},Universe.prototype.reset=function(){this.tilePosition.x=this.tilePositionX=990*Universe.MAP_POINT_SIZE,this.tilePosition.y=this.tilePositionY=990*Universe.MAP_POINT_SIZE,this.moving_x=0,this.moving_y=0,this.xVel=0,this.yVel=0,this.currentObject=null,this.ship.reset(),this.objManager.reset();var a=this.objManager.updateObjects();this.setCurrentObject(a),this.panel.updateCredit()},Universe.prototype.save=function(){localStorage.setItem("universe.moving_x",this.moving_x),localStorage.setItem("universe.moving_y",this.moving_y),localStorage.setItem("universe.xVel",this.xVel),localStorage.setItem("universe.yVel",this.yVel),localStorage.setItem("universe.running",!0),localStorage.setItem("universe.x",this.tilePositionX),localStorage.setItem("universe.y",this.tilePositionY),this.ship.save(),this.objManager.save()},Universe.prototype.load=function(){if("true"!==localStorage.getItem("universe.running"))return void(this.onGameLoaded&&this.onGameLoaded());console.log("loading previosly saved game"),this.moving_x=parseFloat(localStorage.getItem("universe.moving_x")),this.moving_y=parseFloat(localStorage.getItem("universe.moving_y")),this.xVel=parseFloat(localStorage.getItem("universe.xVel")),this.yVel=parseFloat(localStorage.getItem("universe.yVel")),this.tilePositionX=this.tilePosition.x=parseInt(localStorage.getItem("universe.x"),10),this.tilePositionY=this.tilePosition.y=parseInt(localStorage.getItem("universe.y"),10),this.ship.load(),this.objManager.load();var a=this.objManager.updateObjects();this.setCurrentObject(a),this.panel.updateCredit(),this.onGameLoaded&&this.onGameLoaded()},Universe.prototype.loadMap=function(){this.objManager.loadObjects()},Universe.prototype.moveToMapPoint=function(a,b){this.moving_x=a,this.moving_y=b;var c=(this.objManager.updateObjects(),a*Universe.MAP_POINT_SIZE-this.tilePositionX),d=b*Universe.MAP_POINT_SIZE-this.tilePositionY,e=Math.atan2(d-Main.HEIGHT/2,c-Main.WIDTH/2);this.xVel=this.ship.speed*Math.cos(e),this.yVel=this.ship.speed*Math.sin(e),this.ship.setNewRotation(e)},Universe.prototype.moveToGlobalPoint=function(a,b){this.moving_x=(this.tilePositionX+a)/Universe.MAP_POINT_SIZE>>0,this.moving_y=(this.tilePositionY+b)/Universe.MAP_POINT_SIZE>>0;var c=(this.objManager.updateObjects(),Math.atan2(b-Main.HEIGHT/2,a-Main.WIDTH/2));this.xVel=this.ship.speed*Math.cos(c),this.yVel=this.ship.speed*Math.sin(c),this.ship.setNewRotation(c)},Universe.prototype.moveToObject=function(a){this.objectToMove=a,a&&this.moveToMapPoint(a.mapX,a.mapY)},Universe.prototype.click=function(a){if(!this.stopMove){var b=this.objManager.getObject(a.global.x,a.global.y,MapObject.ENEMY_SHIP);if(b)return void this.overlay.laserShot(this.ship,b,20);var c=Main.WIDTH-a.global.x,d=Main.HEIGHT-a.global.y;this.moveToGlobalPoint(c,d)}},Universe.prototype.setCurrentObject=function(a){(a||this.currentObject)&&(a&&a.shipObject&&this.currentObject.type==MapObject.PLANET||(this.currentObject&&(a&&a.type!=MapObject.PLANET||(this.currentObject.shipObject=null),radio("objectLeft").broadcast(this.currentObject)),this.currentObject=a,a&&(a.type==MapObject.PLANET&&(a.shipObject=this),radio("objectTouched").broadcast(a))))},Universe.prototype.update=function(a){var b;if(this.orbitTimer+=a,this.orbitTimer>25&&(this.orbitTimer=0,this.objManager.doOrbitalMovement(),b=this.objManager.updateStaggedObjects(),this.stopMove||this.setCurrentObject(b)),this.statsTimer+=a,this.statsTimer>1e3&&(this.statsTimer=0,this.ship.timeout(),this.panel.update()),0!==this.xVel||0!==this.yVel){var c=(this.tilePositionX+Main.WIDTH/2)/Universe.MAP_POINT_SIZE>>0,d=(this.tilePositionY+Main.HEIGHT/2)/Universe.MAP_POINT_SIZE>>0,e=c,f=d,g=this.xVel,h=this.yVel;c!=this.moving_x?0!==this.xVel&&(this.tilePosition.x+=g,this.tilePositionX+=g,c=(this.tilePositionX+Main.WIDTH/2)/Universe.MAP_POINT_SIZE>>0,0===this.moving_x?this.xVel=0:(e>this.moving_x&&c<this.moving_x||e<this.moving_x&&c>this.moving_x)&&(this.tilePosition.x=this.tilePositionX=(-this.moving_x-Main.WIDTH/2/Universe.MAP_POINT_SIZE)*Universe.MAP_POINT_SIZE,this.xVel=0,this.moving_x=0)):(this.xVel=0,this.moving_x=0),d!=this.moving_y?0!==this.yVel&&(this.tilePosition.y+=h,this.tilePositionY+=h,d=(this.tilePositionY+Main.HEIGHT/2)/Universe.MAP_POINT_SIZE>>0,0===this.moving_y?this.yVel=0:(f>this.moving_y&&d<this.moving_y||f<this.moving_y&&d>this.moving_y)&&(this.tilePosition.y=this.tilePositionY=(-this.moving_y-Main.HEIGHT/2/Universe.MAP_POINT_SIZE)*Universe.MAP_POINT_SIZE,this.yVel=0,this.moving_y=0)):(this.yVel=0,this.moving_y=0),this.objManager.moveObjects(g,h),(e!=c||f!=d)&&(this.panel.update(),b=this.objManager.updateObjects(),this.setCurrentObject(b),b&&b.type==MapObject.PLANET||this.ship.moved()),0===this.xVel&&0===this.yVel&&this.ship.setTexture(this.ship.stayingTexture),this.objectToMove&&this.moveToObject(c!=this.objectToMove.mapX&&d!=this.objectToMove.mapY?this.objectToMove:null)}this.ship.update(),this.overlay.update()},Universe.prototype.objectsLoaded=function(){var a=this.objManager.updateObjects();this.setCurrentObject(a),this.objManager.reset(),this.load()},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Universe),Ship.prototype=Object.create(PIXI.Sprite.prototype),Ship.constructor=Ship,Ship.prototype.setNewRotation=function(a){this.newRotation=-1.57+a,this.newRotation<-3.14&&(this.newRotation+=6.28),this.setTexture(this.flyingTexture)},Ship.prototype.update=function(){this.newRotation>0&&this.rotation<0&&3.14-this.newRotation+3.14+this.rotation<this.newRotation-this.rotation?(this.rotation-=.06,this.newRotation<this.rotation&&(this.rotation=this.newRotation)):this.newRotation<0&&this.rotation>0&&3.14+this.newRotation+3.14-this.rotation<this.rotation-this.newRotation?(this.rotation+=.06,this.newRotation>this.rotation&&(this.rotation=this.newRotation)):this.newRotation<this.rotation?(this.rotation-=.06,this.newRotation>this.rotation&&(this.rotation=this.newRotation)):this.newRotation>this.rotation&&(this.rotation+=.06,this.newRotation<this.rotation&&(this.rotation=this.newRotation)),this.rotation>3.14?this.rotation=-3.14:this.rotation<-3.14&&(this.rotation=3.14)},Ship.prototype.reset=function(){this.rotation=0,this.newRotation=0,this.speed=.9,this.fuel=1e3},Ship.prototype.save=function(){localStorage.setItem(this.name+".rotation",this.rotation),localStorage.setItem(this.name+".newRotation",this.newRotation),localStorage.setItem(this.name+".fuel",this.fuel)},Ship.prototype.load=function(){this.rotation=parseFloat(localStorage.getItem(this.name+".rotation")),this.newRotation=parseFloat(localStorage.getItem(this.name+".newRotation")),this.fuel=parseFloat(localStorage.getItem(this.name+".fuel"))},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Ship),PlayerShip.prototype=Object.create(Ship.prototype),PlayerShip.constructor=PlayerShip,PlayerShip.SANITY_PER_POINT=1,PlayerShip.FOOD_PER_POINT=2,PlayerShip.prototype.timeout=function(){this.food-=this.foodPerPoint,this.sanity-=this.sanityPerPoint,this.updateStats()},PlayerShip.prototype.destroy=function(){},PlayerShip.prototype.updateStats=function(){this.fuel<0?(this.onOutOfFuel&&this.onOutOfFuel(),this.fuel=0):0===this.fuelState&&this.fuel<250?(this.onLowFuel&&this.onLowFuel(),this.fuelState=1):1==this.fuelState&&this.fuel>250&&(this.onNormalFuel&&this.onNormalFuel(),this.fuelState=0),this.food<0?(this.onOutOfFood&&this.onOutOfFood(),this.food=0):0===this.foodState&&this.food<250?(this.onLowFood&&this.onLowFood(),this.foodState=1):1==this.foodState&&this.food>250&&(this.onNormalFood&&this.onNormalFood(),this.foodState=0),this.sanity<0?(this.onOutOfSanity&&this.onOutOfSanity(),this.sanity=0):0===this.sanityState&&this.sanity<250?(this.onLowSanity&&this.onLowSanity(),this.sanityState=1):1==this.sanityState&&this.sanity>250&&(this.onNormalSanity&&this.onNormalSanity(),this.sanityState=0)},PlayerShip.prototype.moved=function(){this.fuel-=this.fuelPerPoint},PlayerShip.prototype.reset=function(){Ship.prototype.reset.call(this),this.fuel=1e3,this.fuelPerPoint=5,this.fuelState=0,this.food=1e3,this.foodPerPoint=2,this.foodState=0,this.sanity=1e3,this.sanityPerPoint=1,this.sanityState=0,this.credit=500,this.onNormalFuel&&this.onNormalFuel(),this.onNormalFood&&this.onNormalFood(),this.onNormalSanity&&this.onNormalSanity()},PlayerShip.prototype.save=function(){Ship.prototype.save.call(this),localStorage.setItem("ship.food",this.food),localStorage.setItem("ship.sanity",this.sanity),localStorage.setItem("ship.credit",this.credit)},PlayerShip.prototype.load=function(){Ship.prototype.load.call(this),0===this.fuel&&(this.fuel=-1,this.fuelState=1),this.food=parseFloat(localStorage.getItem("ship.food")),0===this.food&&(this.food=-1,this.foodState=1),this.sanity=parseFloat(localStorage.getItem("ship.sanity")),0===this.sanity&&(this.sanity=-1,this.sanityState=1),this.credit=parseFloat(localStorage.getItem("ship.credit"))},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=PlayerShip),IntelligentShip.constructor=IntelligentShip,IntelligentShip.prototype=Object.create(Ship.prototype),IntelligentShip.prototype.handleObjectTouched=function(a){a.name==this.name&&0===a.closeShips.length&&(this.disableMovement=!0)},IntelligentShip.prototype.handleObjectLeft=function(a){a.name==this.name&&(this.disableMovement=!1)},IntelligentShip.prototype.destroy=function(){this.respawnTimer=this.respawnTime,this.mapX=0,this.mapY=0,radio("objectDestroyed").broadcast(this),0===this.respawnTimer&&this.objManager.removeShip(this)},IntelligentShip.prototype.computeWaypointMapPoint=function(){var a=this.waypoints[this.waypoint].split(" "),b=null;if(2==a.length){var c=a[0].split("+");2==c.length?(b=this.objManager.getObjectByName(c[0]),this.movingX=b.mapX+parseInt(c[1],10)):this.movingX=parseInt(c[0],10);var d=a[1].split("+");2==d.length?(b=this.objManager.getObjectByName(d[0]),this.movingY=b.mapY+parseInt(d[1],10)):this.movingY=parseInt(d[0],10)}else b=this.objManager.getObjectByName(a[0]),this.movingX=b.mapX,this.movingY=b.mapY;var e=Math.atan2(this.movingY-this.mapY,this.movingX-this.mapX);this.xVel=1.9*Math.cos(e),this.yVel=1.9*Math.sin(e),this.setNewRotation(e)},IntelligentShip.prototype.setNextWaypoint=function(){0!==this.waypoints.length&&this.movingX>this.mapX-3&&this.movingX<this.mapX+3&&this.movingY>this.mapY-3&&this.movingY<this.mapY+3&&(this.waypoint=(this.waypoint+1)%this.waypoints.length,this.computeWaypointMapPoint())},IntelligentShip.prototype.recountPosition=function(){},IntelligentShip.prototype.reset=function(){Ship.prototype.reset.call(this),this.demand={},this.staged=!1,this.mapX=this.origX,this.mapY=this.origY,this.addX=0,this.addY=0,this.cycles=0,this.closeShips=[],this.disableMovement=!1},IntelligentShip.prototype.save=function(){Ship.prototype.save.call(this),0!==this.demand.length&&localStorage.setItem(this.name+".demand",JSON.stringify(this.demand)),localStorage.setItem(this.name+".mapX",this.mapX),localStorage.setItem(this.name+".mapY",this.mapY),localStorage.setItem(this.name+".addX",this.addX),localStorage.setItem(this.name+".addY",this.addY),localStorage.setItem(this.name+".respawnTimer",this.respawnTimer)},IntelligentShip.prototype.load=function(){if("true"==localStorage.getItem("universe.running")){Ship.prototype.load.call(this);var a=JSON.parse(localStorage.getItem(this.name+".demand"));a&&(this.demand=a),this.mapX=parseInt(localStorage.getItem(this.name+".mapX")),this.mapY=parseInt(localStorage.getItem(this.name+".mapY")),this.addX=parseFloat(localStorage.getItem(this.name+".addX")),this.addY=parseFloat(localStorage.getItem(this.name+".addY")),this.respawnTimer=parseInt(localStorage.getItem(this.name+".respawnTimer"))}},IntelligentShip.prototype.shootAt=function(a){this.objManager.universe.overlay.laserShot(this,a,20)},IntelligentShip.prototype.doOrbitalMovement=function(){if(0!==this.respawnTimer&&(this.respawnTimer-=1,0===this.respawnTimer&&this.reset()),this.staged&&0!==this.closeShips.length&&(this.shootTimer+=1,this.shootTimer>100)){var a=this.closeShips[Math.random()*this.closeShips.length>>0];this.shootAt(a),this.shootTimer=0}this.disableMovement||(this.cycles>10&&(this.computeWaypointMapPoint(),this.setNextWaypoint(),this.cycles=0),this.cycles+=1,this.addX+=this.xVel,this.addY+=this.yVel,this.position.x-=this.xVel,this.position.y-=this.yVel,(this.addX>Universe.MAP_POINT_SIZE||this.addX<-Universe.MAP_POINT_SIZE)&&(this.mapX+=this.addX/15>>0,this.addX=this.addX%15,this.mapX=this.mapX>>0),(this.addY>Universe.MAP_POINT_SIZE||this.addY<-Universe.MAP_POINT_SIZE)&&(this.mapY+=this.addY/15>>0,this.addY=this.addY%15,this.mapY=this.mapY>>0),Ship.prototype.update.call(this))},IntelligentShip.prototype.collides=function(a,b){return a>this.position.x-(this.collideWidth>>1)&&a<this.position.x+(this.collideWidth>>1)&&b>this.position.y-(this.collideHeight>>1)&&b<this.position.y+(this.collideHeight>>1)},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=IntelligentShip),Panel.constructor=Panel,Panel.prototype=Object.create(PIXI.Sprite.prototype),Panel.prototype.disableVisiting=function(){this.disableVisit=!0},Panel.prototype.enableVisiting=function(){this.disableVisit=!1},Panel.prototype.updateCredit=function(){this.credit.setText(this.ship.credit),this.fuel.width=.08*this.ship.fuel,this.food.width=.08*this.ship.food,this.sanity.width=.08*this.ship.sanity},Panel.prototype.update=function(){this.fuel.width=.08*this.ship.fuel,this.food.width=.08*this.ship.food,this.sanity.width=.08*this.ship.sanity},Panel.prototype.handleObjectTouched=function(a){return a.type==MapObject.STAR||a.type==MapObject.SHIP&&0!==a.closeShips.length?void this.handleObjectLeft(a):(this.object=a,void this.visit.setText("Visit "+a.name))},Panel.prototype.handleObjectLeft=function(){this.visit.setText(""),this.object=null},Panel.prototype.click=function(a){a.global.x>470&&a.global.x<630?this.onShowInventory&&this.onShowInventory():a.global.x>382&&a.global.x<470?this.onShowMap&&this.onShowMap():a.global.x>272&&a.global.x<382?this.onShowMenu&&this.onShowMenu():this.object&&this.onVisitObject&&!this.disableVisit&&this.ship.food>0&&this.ship.sanity>0&&this.onVisitObject(this.object)},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Panel),MapObject.PLANET=0,MapObject.STAR=1,MapObject.SHIP=2,MapObject.ENEMY_SHIP=3,"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=MapObject),CelestialBody.constructor=CelestialBody,CelestialBody.prototype=Object.create(PIXI.Sprite.prototype),CelestialBody.prototype.recountPosition=function(){if(this.parentObject){var a=this.a/Universe.MAP_POINT_SIZE*Math.cos(this.posParam)>>0,b=this.b/Universe.MAP_POINT_SIZE*Math.sin(this.posParam)>>0;this.mapX=this.parentObject.mapX-a,this.mapY=this.parentObject.mapY-b,this.prevX=this.a*Math.cos(this.posParam),this.prevY=this.b*Math.sin(this.posParam)}console.log(this.name+": "+this.mapX+" "+this.mapY);for(var c=0;c<this.childrenObjects.length;c++){var d=this.childrenObjects[c];d.recountPosition()}},CelestialBody.prototype.reset=function(){this.demand={},this.staged=!1,this.staggedChildren=0,this.posParam="Earth"==this.name?0:6.28*Math.random(),this.addX=0,this.addY=0,this.prevX=this.a*Math.cos(this.posParam),this.prevY=this.b*Math.sin(this.posParam),this.cycles=0,this.shipObject=null},CelestialBody.prototype.save=function(){0!==this.demand.length&&localStorage.setItem(this.name+".demand",JSON.stringify(this.demand)),localStorage.setItem(this.name+".mapX",this.mapX),localStorage.setItem(this.name+".mapY",this.mapY),localStorage.setItem(this.name+".posParam",this.posParam),localStorage.setItem(this.name+".addX",this.addX),localStorage.setItem(this.name+".addY",this.addY)},CelestialBody.prototype.load=function(){if("true"==localStorage.getItem("universe.running")){var a=JSON.parse(localStorage.getItem(this.name+".demand"));a&&(this.demand=a),this.mapX=parseInt(localStorage.getItem(this.name+".mapX")),this.mapY=parseInt(localStorage.getItem(this.name+".mapY")),this.posParam=parseFloat(localStorage.getItem(this.name+".posParam")),this.addX=parseFloat(localStorage.getItem(this.name+".addX")),this.addY=parseFloat(localStorage.getItem(this.name+".addY")),this.prevX=this.a*Math.cos(this.posParam),this.prevY=this.b*Math.sin(this.posParam)}},CelestialBody.prototype.doOrbitalMovement=function(a,b,c,d){if(0!==this.speed&&this.parentObject){if(this.staged||this.cycles>10){var e=this.a*Math.cos(this.posParam),f=this.b*Math.sin(this.posParam);c+=this.prevX-e,d+=this.prevY-f,this.addX+=this.prevX-e,this.addY+=this.prevY-f,this.prevX=e,this.prevY=f,this.position.x=e+this.parentObject.position.x,this.position.y=f+this.parentObject.position.y,this.shipObject&&0===this.shipObject.moving_x&&0===this.shipObject.moving_y&&(this.shipObject.xVel+=c,this.shipObject.yVel+=d),(this.addX>Universe.MAP_POINT_SIZE||this.addX<-Universe.MAP_POINT_SIZE)&&(a+=this.addX/15>>0,this.addX=this.addX%15),(this.addY>Universe.MAP_POINT_SIZE||this.addY<-Universe.MAP_POINT_SIZE)&&(b+=this.addY/15>>0,this.addY=this.addY%15),this.cycles=0}else this.cycles+=1;this.posParam+=this.speed}this.mapX+=a,this.mapY+=b;for(var g=0;g<this.childrenObjects.length;g++){var h=this.childrenObjects[g];h.doOrbitalMovement(a,b,c,d)}},CelestialBody.prototype.collides=function(a,b){return a>this.position.x-(this.collideWidth>>1)&&a<this.position.x+(this.collideWidth>>1)&&b>this.position.y-(this.collideHeight>>1)&&b<this.position.y+(this.collideHeight>>1)},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=CelestialBody),ObjectManager.prototype.getShip=function(a){for(var b=0;b<this.ships.length;b++)if(this.ships[b].name==a)return this.ships[b];return null},ObjectManager.prototype.addShip=function(a){this.objects[this.objects.length]=a,this.ships[this.ships.length]=a},ObjectManager.prototype.removeShip=function(a){this.removeFromStage(a),this.objects.splice(this.objects.indexOf(a),1),this.ships.splice(this.ships.indexOf(a),1)},ObjectManager.prototype.spawnShipCopy=function(a,b,c,d,e,f){var g=this.getShip(a);if(null===g)return void console.log("WARNING: ship with name "+a+" not found");var h=new IntelligentShip(this,b,g.type,g.texture,c,d,g.items,g.prices,g.orbit_speed,e,g.attack,g.defense,f);this.addShip(h)},ObjectManager.prototype.parseObjects=function(a){var b,c,d,e={};for(b in a)c=a[b],d=c.type>=MapObject.SHIP?new IntelligentShip(this,b,c.type,c.texture,c.x,c.y,c.items,c.prices,c.orbit_speed,c.waypoints,c.attack,c.defense,1e3):new CelestialBody(this,b,c.type,c.texture,c.x,c.y,c.items,c.prices,c.orbit_a,c.orbit_b,c.orbit_speed),this.objects[this.objects.length]=d,e[b]=d,c.type>=MapObject.SHIP&&(this.ships[this.ships.length]=d);
for(b in a)if(c=a[b],!(c.type>=MapObject.SHIP)){var f=c.orbit_center;""!==f?(e[b].parentObject=e[f],e[f].childrenObjects[e[f].childrenObjects.length]=e[b]):this.centralObject=e[b]}this.updateObjects(),this.onObjectsLoaded&&this.onObjectsLoaded()},ObjectManager.prototype.loadObjects=function(){var a=this,b=new PIXI.JsonLoader("resources/map.json");b.on("loaded",function(b){a.parseObjects(b.content.content.json.map)}),b.load()},ObjectManager.prototype.doOrbitalMovement=function(){this.centralObject&&this.centralObject.doOrbitalMovement(0,0,0,0);for(var a=0;a<this.ships.length;a++)this.ships[a].doOrbitalMovement(0,0,0,0)},ObjectManager.prototype.moveObjects=function(a,b){var c,d;for(c=0;c<this.boundToStaged.length;c++)d=this.boundToStaged[c],d.position.x+=a,d.position.y+=b;for(c=0;c<this.staged.length;c++)d=this.staged[c],d.position.x+=a,d.position.y+=b},ObjectManager.prototype.removeFromStage=function(a){if(this.staged.splice(this.staged.indexOf(a),1),a.staged=!1,this.universe.removeChild(a),a.type<MapObject.SHIP)for(0!==a.staggedChildren&&(this.boundToStaged[this.boundToStaged.length]=a);a.parentObject;)a=a.parentObject,a.staggedChildren-=1,0!==a.staggedChildren||a.staged||this.boundToStaged.splice(this.boundToStaged.indexOf(a),1);else{a.closeShips.splice(0,a.closeShips.length);for(var b=0;b<this.staged.length;b++){var c=this.staged[b];if(!(c.type<MapObject.SHIP||c.name==a.name)&&a.type!==c.type)for(var d=0;d<c.closeShips.length;d++)if(c.closeShips[d].name==a.name){c.closeShips.splice(d,1);break}}}},ObjectManager.prototype.addToStage=function(a){if(a.type>=MapObject.SHIP){a.staged=!0,this.staged[this.staged.length]=a,a.position.x=-(a.mapX-this.left)*Universe.MAP_POINT_SIZE,a.position.y=-(a.mapY-this.top)*Universe.MAP_POINT_SIZE,this.universe.addChildAt(a,this.universe.children.length-1),a.type==MapObject.ENEMY_SHIP&&(a.closeShips[a.closeShips.length]=this.universe.ship);for(var b=0;b<this.staged.length;b++){var c=this.staged[b];c.type<MapObject.SHIP||c.name==a.name||a.type!==c.type&&(c.closeShips[c.closeShips.length]=a,a.closeShips[a.closeShips.length]=c)}}else for(0!==a.staggedChildren?this.boundToStaged.splice(this.boundToStaged.indexOf(a),1):(a.position.x=-(a.mapX-this.left)*Universe.MAP_POINT_SIZE,a.position.y=-(a.mapY-this.top)*Universe.MAP_POINT_SIZE),a.staged=!0,this.staged[this.staged.length]=a,this.universe.addChildAt(a,0);a.parentObject;)a=a.parentObject,a.staggedChildren+=1,1!=a.staggedChildren||a.staged||(a.position.x=-(a.mapX-this.left)*Universe.MAP_POINT_SIZE,a.position.y=-(a.mapY-this.top)*Universe.MAP_POINT_SIZE,this.boundToStaged[this.boundToStaged.length]=a)},ObjectManager.prototype.getObjectByName=function(a){for(var b=0;b<this.objects.length;b++)if(this.objects[b].name==a)return this.objects[b];return null},ObjectManager.prototype.getObject=function(a,b,c){for(var d=0;d<this.staged.length;d++){var e=this.staged[d];if(a>e.position.x-(e.width>>1)&&a<e.position.x-(e.width>>1)+e.width&&b>e.position.y-(e.height>>1)&&b<e.position.y-(e.height>>1)+e.height&&(null===c||e.type==c))return e}return null},ObjectManager.prototype.updateObjects=function(){this.left=(this.universe.tilePositionX+Main.WIDTH)/Universe.MAP_POINT_SIZE>>0,this.right=this.universe.tilePositionX/Universe.MAP_POINT_SIZE>>0,this.top=(this.universe.tilePositionY+Main.HEIGHT)/Universe.MAP_POINT_SIZE>>0,this.bottom=this.universe.tilePositionY/Universe.MAP_POINT_SIZE>>0;for(var a=null,b=0;b<this.objects.length;b++){var c=this.objects[b];!c.staged&&c.mapX<=this.left+18&&c.mapX>=this.right-18&&c.mapY<=this.top+18&&c.mapY>=this.bottom-18?this.addToStage(c):c.staged&&(c.mapX>this.left+18||c.mapX<this.right-18||c.mapY>this.top+18||c.mapY<this.bottom-18)?this.removeFromStage(c):c.staged&&c.collides(Main.CENTER_X,Main.CENTER_Y)&&(a=c)}return a},ObjectManager.prototype.updateStaggedObjects=function(){for(var a=null,b=0;b<this.objects.length;b++){var c=this.objects[b];!c.staged&&c.mapX<=this.left+18&&c.mapX>=this.right-18&&c.mapY<=this.top+18&&c.mapY>=this.bottom-18?this.addToStage(c):c.staged&&(c.mapX>this.left+18||c.mapX<this.right-18||c.mapY>this.top+18||c.mapY<this.bottom-18)?this.removeFromStage(c):c.staged&&c.collides(Main.CENTER_X,Main.CENTER_Y)&&(a=c)}return a},ObjectManager.prototype.reset=function(){for(var a=0;a<this.objects.length;a++){var b=this.objects[a];b.staged&&this.universe.removeChild(b),b.reset()}this.centralObject&&this.centralObject.recountPosition(),this.staged.length=0,this.boundToStaged.length=0},ObjectManager.prototype.save=function(){for(var a=0;a<this.objects.length;a++){var b=this.objects[a];b.save()}},ObjectManager.prototype.load=function(){this.reset();for(var a=0;a<this.objects.length;a++){var b=this.objects[a];b.load()}this.updateObjects(),this.centralObject&&this.centralObject.recountPosition()},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=ObjectManager),Inventory.constructor=Inventory,Inventory.prototype=Object.create(PIXI.Sprite.prototype),Inventory.prototype.click=function(a){var b=a.getLocalPosition(this).x/64>>0,c=a.getLocalPosition(this).y/64>>0,d=this.inventory[b][c];if(d){var e=d.item;this.onItemClicked&&this.onItemClicked(e,this.ship)}},Inventory.prototype.correctPrice=function(a,b){return b},Inventory.prototype.recountStats=function(){this.ship.fuelPerPoint=0,this.ship.sanityPerPoint=PlayerShip.SANITY_PER_POINT,this.ship.foodPerPoint=PlayerShip.FOOD_PER_POINT,this.ship.speed=0,this.ship.attack=0,this.ship.defense=0;var a=!1;for(x=0;7>x;x++)for(y=0;7>y;y++)if(this.inventory[x][y]){var b=this.inventory[x][y].item;b.fuel&&(this.ship.fuelPerPoint+=b.fuel),b.speed&&(this.ship.speed+=b.speed),b.sanity&&(this.ship.sanityPerPoint+=b.sanity),b.food&&(this.ship.foodPerPoint+=b.food),b.defense&&(this.ship.defense+=b.defense),b.attack&&(this.ship.attack+=b.attack),b.type==Item.ENGINE&&(a=!0)}a||(this.ship.speed=0),this.ship.fuelPerPoint<0&&(this.ship.fuelPerPoint=0),this.ship.speed<0&&(this.ship.speed=0)},Inventory.prototype.hasItem=function(a){for(var b=0;7>b;b++)for(var c=0;7>c;c++)if(this.inventory[b][c]&&this.inventory[b][c].item.id==a)return!0;return!1},Inventory.prototype.itemCount=function(a){for(var b=0,c=0;7>c;c++)for(var d=0;7>d;d++)this.inventory[c][d]&&this.inventory[c][d].item.id==a&&(b+=1);return b},Inventory.prototype.removeAll=function(){for(var a=0;7>a;a++)for(var b=0;7>b;b++)this.inventory[a][b]&&(this.removeChild(this.inventory[a][b]),this.inventory[a][b]=null)},Inventory.prototype.removeItem=function(a){var b=a;"object"==typeof b&&(b=a.id);for(var c=0;7>c;c++)for(var d=0;7>d;d++)if(this.inventory[c][d]&&this.inventory[c][d].item.id==b)return this.removeChild(this.inventory[c][d]),this.inventory[c][d]=null,void this.recountStats()},Inventory.prototype.freeSlotsCount=function(){for(var a=0,b=0;7>b;b++)for(var c=0;7>c;c++)this.inventory[b][c]||(a+=1);return a},Inventory.prototype.addItem=function(a,b,c){if(this.itemManager.getItem(a).type==Item.FOOD)return this.ship.food=1e3,!0;if(this.itemManager.getItem(a).type==Item.FUEL)return this.ship.fuel=1e3,!0;if(!b||!c){var d=!1;for(b=0;7>b;b++){for(c=0;7>c;c++)if(!this.inventory[b][c]){d=!0;break}if(d)break}}if(b>=7||c>=7)return!1;var e=this.itemManager.createSprite(a);return e.position.x=64*b,e.position.y=64*c,this.addChild(e),this.inventory[b][c]=e,this.recountStats(),!0},Inventory.prototype.itemsLoaded=function(){this.reset(),this.load()},Inventory.prototype.reset=function(){this.removeAll(),this.addItem(0),this.addItem(1),this.addItem(11),this.addItem(12)},Inventory.prototype.save=function(){for(var a=0;7>a;a++)for(var b=0;7>b;b++)this.inventory[a][b]?localStorage.setItem("inventory."+a+"."+b,this.inventory[a][b].item.id):localStorage.setItem("inventory."+a+"."+b,-1)},Inventory.prototype.load=function(){if("true"==localStorage.getItem("universe.running")){this.removeAll();for(var a=0;7>a;a++)for(var b=0;7>b;b++){var c=parseInt(localStorage.getItem("inventory."+a+"."+b));c>=0?this.addItem(c,a,b):localStorage.setItem("inventory."+a+"."+b,-1)}this.recountStats()}},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Inventory),PlanetInventory.constructor=PlanetInventory,PlanetInventory.prototype=Object.create(PIXI.Sprite.prototype),PlanetInventory.prototype.click=function(a){var b=a.getLocalPosition(this).x/64>>0,c=a.getLocalPosition(this).y/64>>0,d=this.inventory[b][c];return d?"string"==typeof d?void this.dialogManager.executeDialog(d):void(this.onItemClicked&&this.onItemClicked(d.item,this.ship)):void 0},PlanetInventory.prototype.correctPrice=function(a,b,c){if(a.type==Item.FUEL?b*=1e3-this.ship.fuel:a.type==Item.FOOD&&(b*=1e3-this.ship.food),b*=this.planet.prices[a.type]*(1+(a.id in this.planet.demand?this.planet.demand[a.id]:0)),c)for(var d=0;d<this.planet.items.length;d++)this.planet.items[d]==a.id&&(b*=.75);else b=-b;return b>>0},PlanetInventory.prototype.clear=function(){for(var a=0;7>a;a++)for(var b=0;7>b;b++)this.inventory[a][b]&&(this.removeChild(this.inventory[a][b]),this.inventory[a][b]=null)},PlanetInventory.prototype.hasItem=function(a){for(var b=0;7>b;b++)for(var c=0;7>c;c++)if(this.inventory[b][c]&&this.inventory[b][c].item.id==a)return!0;return!1},PlanetInventory.prototype.removeItem=function(a){a.type!=Item.FOOD&&a.type!=Item.FUEL&&(a.id in this.planet.demand||(this.planet.demand[a.id]=0),this.planet.demand[a.id]+=.05)},PlanetInventory.prototype.addItem=function(a){a in this.planet.demand||(this.planet.demand[a]=0),this.planet.demand[a]-=.05},PlanetInventory.prototype._addItem=function(a,b,c){if(!b||!c){var d=!1;for(b=0;7>b;b++){for(c=0;7>c;c++)if(!this.inventory[b][c]){d=!0;break}if(d)break}}if(b>=7||c>=7)return!1;var e=this.itemManager.createSprite(a);return e.position.x=64*b,e.position.y=64*c,this.addChild(e),this.inventory[b][c]=e,!0},PlanetInventory.prototype.addDialogs=function(){if(this.dialogManager){var a=this.dialogManager.objectToDialog[this.planet.name];if(a)for(var b=0;b<a.length;b++){var c=PIXI.Texture.fromImage(this.dialogManager.dialogs[a[b]].face),d=new PIXI.Sprite(c);d.position.x=384,d.position.y=64*b,d.width=64,d.height=64,this.addChild(d),this.inventory[6][b]=a[b]}}},PlanetInventory.prototype.setPlanet=function(a){if(this.planet=a,this.planet){this._addItem(2),this._addItem(3);for(var b=0;b<this.planet.items.length;b++)this._addItem(this.planet.items[b]);this.addDialogs()}else this.clear()},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=PlanetInventory),Item.ENGINE=0,Item.FUEL=1,Item.FOOD=2,Item.SHIP_IMPROVEMENT=3,Item.SPECIAL_FOOD=4,Item.MACHINE=5,Item.GUN=6,Item.SHIP_WEAPON=7,Item.SHIP_SHIELD=8,Item.LAST_CATEGORY=9,Item.constructor=Item,"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Item),ItemManager.prototype.loadItems=function(){var a=this,b=new PIXI.JsonLoader("resources/items.json");b.on("loaded",function(b){for(var c in b.content.content.json.items){var d=b.content.content.json.items[c],e=new Item(a.items.length,d.name,d.type,d.texture,d.price,d.speed,d.fuel,d.sanity,d.food,d.attack,d.defense);a.items[a.items.length]=e}a.onItemsLoaded&&a.onItemsLoaded()}),b.load()},ItemManager.prototype.addItem=function(a){this.items[this.items.length]=a},ItemManager.prototype.createSprite=function(a){return new ItemSprite(this.items[a])},ItemManager.prototype.getItem=function(a){return this.items[a]},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=ItemManager),ItemSprite.constructor=ItemSprite,ItemSprite.prototype=Object.create(PIXI.Sprite.prototype),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=ItemSprite),ItemInfo.constructor=ItemInfo,ItemInfo.prototype=Object.create(PIXI.Sprite.prototype),ItemInfo.prototype.doAction=function(){if(this.to){var a=this.item.price;if(a=this.from.correctPrice(this.item,a,!1),this.from&&(a=this.to.correctPrice(this.item,a,!0)),this.ship.credit+a<0)return;this.from.removeItem(this.item),this.ship.credit+=a,this.to.addItem(this.item.id)}else this.from.removeItem(this.item);this.onClose&&this.onClose()},ItemInfo.prototype.click=function(a){var b=a.getLocalPosition(this).x,c=a.getLocalPosition(this).y;230>c||(b>200?this.onClose&&this.onClose():this.doAction())},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=ItemInfo),Map.PIXELS_PER_POINT=.7,Map.LEFT=400+896/Map.PIXELS_PER_POINT,Map.TOP=600+448/Map.PIXELS_PER_POINT,Map.constructor=Map,Map.prototype=Object.create(PIXI.Graphics.prototype),Map.prototype.update=function(){this.clear(),this.beginFill(0,.6),this.drawRect(0,0,896,448),this.endFill(),this.moveTo(this.position.x,this.position.y);var a,b;Map.LEFT=(this.universe.tilePositionX+Main.WIDTH/2)/Universe.MAP_POINT_SIZE+480/Map.PIXELS_PER_POINT,Map.TOP=(this.universe.tilePositionY+Main.HEIGHT/2)/Universe.MAP_POINT_SIZE+256/Map.PIXELS_PER_POINT,objects=this.universe.objManager.objects;for(var c=0;c<objects.length;c++){var d=objects[c];d.type==MapObject.PLANET?this.lineStyle(2,65535,1):d.type==MapObject.SHIP?this.lineStyle(2,65280,1):d.type==MapObject.ENEMY_SHIP?this.lineStyle(2,16711680,1):this.lineStyle(2,16776960,1),a=-(d.mapX-Map.LEFT)*Map.PIXELS_PER_POINT,b=-(d.mapY-Map.TOP)*Map.PIXELS_PER_POINT,this.drawRect(a-5,b-5,10,10),null===d.mapText&&(d.mapText=new PIXI.Text(d.name,{font:"14px Snippet",fill:"white",align:"center"}),this.addChild(d.mapText)),d.mapText.position.x=a+8,d.mapText.position.y=b-6}a=-(((this.universe.tilePositionX+Main.WIDTH/2)/Universe.MAP_POINT_SIZE-Map.LEFT)*Map.PIXELS_PER_POINT)>>0,b=-(((this.universe.tilePositionY+Main.HEIGHT/2)/Universe.MAP_POINT_SIZE-Map.TOP)*Map.PIXELS_PER_POINT)>>0,this.lineStyle(2,65280,1),this.drawRect(a-5,b-5,10,10),this.drawCircle(a,b,this.universe.ship.fuel/this.universe.ship.fuelPerPoint*Map.PIXELS_PER_POINT)},AssetsLoader.constructor=AssetsLoader,AssetsLoader.prototype=Object.create(PIXI.AssetLoader.prototype),AssetsLoader.prototype.assetLoaded=function(a){this.progressBar.width=200/a*(a-this.loadCount),this.renderer.render(this.stage)},Menu.constructor=Menu,Menu.prototype=Object.create(PIXI.Sprite.prototype),Menu.prototype.show=function(){this.stg.addChild(this),this.showed=!0},Menu.prototype.hide=function(){this.stg.removeChild(this),this.showed=!1},Menu.prototype.toggle=function(){this.showed?this.hide():this.show()},Menu.prototype.click=function(a){var b=a.getLocalPosition(this).y;b>0&&64>b?(radio("showQuests").broadcast(),this.hide()):b>64&&128>b?(radio("showStatistics").broadcast(),this.hide()):b>384&&(radio("restartGame").broadcast(),this.hide())},DialogManager.prototype.reset=function(){this.currentDialog&&(this.stage.removeChild(this.currentDialog),this.currentDialog=null)},DialogManager.prototype.parseDialogs=function(a){for(var b in a){for(var c=a[b],d=0;d<c.events.length;d++)this.eventToDialog[c.events[d]]=b;c.object in this.objectToDialog||(this.objectToDialog[c.object]=[]),this.objectToDialog[c.object][this.objectToDialog[c.object].length]=b,this.dialogs[b]=new DialogObject(c.face,c.once,c.dialog)}},DialogManager.prototype.loadDialogs=function(){var a=this;loader=new PIXI.JsonLoader("resources/dialogs.json"),loader.on("loaded",function(b){a.parseDialogs(b.content.content.json.dialog)}),loader.load()},DialogManager.prototype.handleDialogFinished=function(){this.stage.removeChild(this.currentDialog),this.currentDialog=null,this.currentName="",radio("dialogFinished").broadcast()},DialogManager.prototype.executeDialog=function(a,b){if(this.currentName!=a){var c=this.dialogs[a];if(this.currentDialog&&this.handleDialogFinished(this.currentDialog),this.currentDialog=new Dialog(c.face,c.dialog,this.inventory,this.objManager),this.currentDialog.onDialogFinished=this.handleDialogFinished.bind(this),this.currentDialog.start()){if(c.once&&b){if("1"==localStorage.getItem("dialog."+a))return;localStorage.setItem("dialog."+a,"1")}this.stage.addChild(this.currentDialog),radio("dialogStarted").broadcast()}else this.currentDialog=null}},DialogManager.prototype.handleObjectTouched=function(a){var b=a.name+"_touched";b in this.eventToDialog&&this.executeDialog(this.eventToDialog[b],!0)},DialogManager.prototype.handleObjectDestroyed=function(a){var b=a.name+"_destroyed";b in this.eventToDialog&&this.executeDialog(this.eventToDialog[b],!0)},DialogManager.prototype.handleObjectLeft=function(a){var b=a.name+"_left";return!(b in this.eventToDialog),void(this.currentDialog&&this.handleDialogFinished(this.currentDialog))},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=DialogManager),Dialog.constructor=Dialog,Dialog.prototype=Object.create(PIXI.Sprite.prototype),Dialog.prototype.start=function(){return this.generate(this.dialog)},Dialog.prototype.showNPCSentence=function(a){var b=new PIXI.Text(a,{font:"20px Snippet",fill:"white",wordWrap:!0,wordWrapWidth:950});b.position.x=70,b.position.y=10,this.addChild(b)},Dialog.prototype.showSentence=function(a,b){var c=new PIXI.Text(b,{font:"20px Snippet",fill:"lightgreen",wordWrap:!0,wordWrapWidth:950});c.position.x=70,c.position.y=70+35*a,this.addChild(c)},Dialog.prototype.checkCommandsRestrictions=function(a){for(var b,c,d,e=1;e<a.length;e++){var f=a[e].split(" ");if("add_item"==f[0]){if(b=3==f.length?parseInt(f[2],10):1,this.inventory.freeSlotsCount()<b)return"You don't have free space on your ship, you need at least "+b+" free slots."}else if("remove_credit"==f[0]){if(this.inventory.ship.credit-parseInt(f[1])<0)return"You don't have enough credits, you need at least "+f[1]+" credits."}else if("start_quest"==f[0]){for(c=!1,d=0;10>d;d++)if(text=localStorage.getItem("quests."+d),!text||""===text){c=!0;break}if(!c)return"Sorry, you have too much quests in progress."}}return null},Dialog.prototype.parseWaypoints=function(a){var b=[],c=a.indexOf("[");if(-1==c)return b;var d=a.indexOf("]",c);if(-1==d)return b;for(var e=a.substring(c+1,d).split(" "),f=0;f<e.length;f++){var g=parseInt(e[f],10);isNaN(g)&&-1==e[f].indexOf("+")?b[b.length]=e[f]:(b[b.length]=e[f]+" "+e[f+1],f+=1)}return b},Dialog.prototype.executeCommands=function(a){var b=this.checkCommandsRestrictions(a);if(b)return b;for(var c,d,e,f=1;f<a.length;f++){var g=a[f].split(" ");if("add_item"==g[0])for(c=3==g.length?parseInt(g[2],10):1,d=0;c>d;d++)this.inventory.addItem(parseInt(g[1]));else if("remove_item"==g[0])for(c=3==g.length?parseInt(g[2],10):1,d=0;c>d;d++)this.inventory.removeItem(g[1]);else if("add_token"==g[0])localStorage.setItem("dialog."+g[1],1);else if("start_quest"==g[0]){for(d=0;10>d;d++)if(e=localStorage.getItem("quests."+d),!e||""===e){localStorage.setItem("quests."+d,g.slice(2).join(" ")),localStorage.setItem("dialog."+g[1],d);break}}else"finish_quest"==g[0]?(e=localStorage.getItem("dialog."+g[1]),console.log("FINISH "+e),e&&""!==e&&(localStorage.removeItem("quests."+e),localStorage.setItem("dialog."+g[1],-2))):"restart_quest"==g[0]?(e=localStorage.getItem("dialog."+g[1]),e&&""!==e&&(localStorage.removeItem("quests."+e),localStorage.removeItem("dialog."+g[1]))):"add_credit"==g[0]?(this.inventory.ship.credit+=parseInt(g[1]),radio("creditChanged").broadcast()):"remove_credit"==g[0]?(this.inventory.ship.credit-=parseInt(g[1]),radio("creditChanged").broadcast()):"spawn_ship_copy"==g[0]&&this.objManager.spawnShipCopy(g[1],g[2],parseInt(g[3],10),parseInt(g[4],10),this.parseWaypoints(a[f]),0)}return a[0]},Dialog.prototype.executeFilter=function(a){if(!a||"string"==typeof a||Array.isArray(a))return!0;if(!("filter"in a))return!0;for(var b,c,d=0;d<a.filter.length;d++){var e=a.filter[d].split(" "),f="!"==e[0].charAt(0);if(f&&(e[0]=e[0].substring(1)),"has_token"==e[0]||"has_quest"==e[0]){if(c=localStorage.getItem("dialog."+e[1]),(null!==c&&""!==c&&"-2"!=c)==f)return!1}else if("finished_quest"==e[0]){if("-2"==localStorage.getItem("dialog."+e[1])==f)return!1}else if("has_item"==e[0]){if(b=3==e.length?parseInt(e[2],10):1,1===b&&this.inventory.hasItem(e[1])==f)return!1;if(this.inventory.itemCount(e[1])==b==f)return!1}}return!0},Dialog.prototype.showDefaultSentences=function(){this.showSentence(0,"Ask something else."),this.showSentence(1,"Leave the conversation.")},Dialog.prototype.generate=function(a){if(this.root=a,this.rootKeys=[],this.removeChildren(),this.face&&this.addChild(this.face),Array.isArray(a)&&(this.root=this.executeCommands(a),a=this.root),"string"==typeof a)return this.showNPCSentence(a),this.showDefaultSentences(),!0;var b=!1;for(var c in a)if("filter"!=c&&this.executeFilter(a[c])){this.showNPCSentence(c),b=!0;var d=0;for(var e in a[c])"filter"!=e&&this.executeFilter(a[c][e])&&(this.showSentence(d++,e),this.rootKeys[this.rootKeys.length]=e);this.root=a[c];break}return b?(0===this.rootKeys.length&&this.showDefaultSentences(),!0):!1},Dialog.prototype.choose=function(a){return 0===this.rootKeys.length?void(0===a?this.start()||this.onDialogFinished():this.onDialogFinished()):void(a>=this.rootKeys.length||this.generate(this.root[this.rootKeys[a]])===!1&&this.onDialogFinished())},Dialog.prototype.click=function(a){var b=(a.getLocalPosition(this).x,a.getLocalPosition(this).y),c=-1;c=(b-70)/35>>0,0>c||c>3||this.choose(c)},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Dialog),Statistics.constructor=Statistics,Statistics.prototype=Object.create(PIXI.Graphics.prototype),Statistics.prototype.show=function(){this.clear(),this.beginFill(0,1),this.drawRect(0,0,448,448),this.endFill(),this.lineStyle(2,8421504,1),this.drawRect(0,0,448,448);var a,b=10;a=new PIXI.Text("Speed: "+this.ship.speed,{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=10,a.position.y=b,b+=30,this.addChild(a),a=new PIXI.Text("Fuel consumption: "+this.ship.fuelPerPoint,{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=10,a.position.y=b,b+=30,this.addChild(a),a=new PIXI.Text("Food consumption: "+this.ship.foodPerPoint,{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=10,a.position.y=b,b+=30,this.addChild(a),a=new PIXI.Text("Sanity decrease: "+this.ship.sanityPerPoint,{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=10,a.position.y=b,b+=30,this.addChild(a),a=new PIXI.Text("Attack number: "+this.ship.attack,{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=10,a.position.y=b,b+=30,this.addChild(a),a=new PIXI.Text("Defense number: "+this.ship.defense,{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=10,a.position.y=b,b+=30,this.addChild(a),this.lineStyle(2,8421504,1),this.drawRect(224,400,224,48),a=new PIXI.Text("Close",{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=300,a.position.y=415,this.addChild(a),this.showed||(this.showed=!0,this.stg.addChild(this))},Statistics.prototype.hide=function(){this.showed&&(this.showed=!1,this.removeChildren(),this.stg.removeChild(this))},Statistics.prototype.click=function(a){var b=(a.getLocalPosition(this).x,a.getLocalPosition(this).y);b>400&&this.hide()},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Statistics),Quests.constructor=Quests,Quests.prototype=Object.create(PIXI.Graphics.prototype),Quests.prototype.show=function(){this.clear(),this.beginFill(0,1),this.drawRect(0,0,560,560),this.endFill(),this.lineStyle(2,8421504,1),this.drawRect(0,0,560,560);for(var a,b=10,c=0;10>c;c++){var d=localStorage.getItem("quests."+c);d&&""!==d&&(a=new PIXI.Text("- "+d,{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=10,a.position.y=b,b+=30,this.addChild(a))}this.lineStyle(2,8421504,1),this.drawRect(336,512,224,48),a=new PIXI.Text("Close",{font:"24px Snippet",fill:"white",align:"center"}),a.position.x=420,a.position.y=527,this.addChild(a),this.showed||(this.showed=!0,this.stg.addChild(this))},Quests.prototype.hide=function(){this.showed&&(this.showed=!1,this.removeChildren(),this.stg.removeChild(this))},Quests.prototype.click=function(a){var b=(a.getLocalPosition(this).x,a.getLocalPosition(this).y);b>400&&this.hide()},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=Quests),Main.WIDTH=1024,Main.HEIGHT=672,Main.CENTER_X=Main.WIDTH/2,Main.CENTER_Y=Main.HEIGHT/2,Main.prototype.update=function(){var a=Date.now();this.universe.update(a-this.tickRate),this.map.showed&&this.map.update(),this.renderer.render(this.stage),this.stop||requestAnimFrame(this.update.bind(this)),a-this.lastSaveTime>3e3&&(this.lastSaveTime=a,this.universe.save(),this.inventory.save()),this.tickRate=a},Main.prototype.showCenterMsg=function(a){this.msg&&this.stage.removeChild(this.msg),this.msg=new PIXI.Text(a,{font:"40px Snippet",fill:"white",align:"left"}),this.msg.position.x=Main.CENTER_X-this.msg.width/2,this.msg.position.y=Main.CENTER_Y-this.msg.height/2,this.stage.addChild(this.msg)},Main.prototype.outOfFuel=function(){this.showCenterMsg("Captain, we are out of fuel!"),this.universe.stopMove=!0},Main.prototype.outOfFood=function(){this.showCenterMsg("Captain, we are out of food!"),this.universe.stopMove=!0},Main.prototype.outOfSanity=function(){this.showCenterMsg("Captain, we are crazy!"),this.universe.stopMove=!0},Main.prototype.lowFuel=function(){this.showCenterMsg("Captain, we have almost no fuel!"),this.universe.stopMove=!1},Main.prototype.lowFood=function(){this.showCenterMsg("Captain, we have almost no food!")},Main.prototype.lowSanity=function(){this.showCenterMsg("Captain, we are starting to be crazy!")},Main.prototype.normalFuel=function(){this.stage.removeChild(this.msg),this.msg=null,this.universe.stopMove=!1},Main.prototype.normalFood=function(){this.stage.removeChild(this.msg),this.msg=null},Main.prototype.normalSanity=function(){this.stage.removeChild(this.msg),this.msg=null},Main.prototype.visitObject=function(a){this.universe.ship.sanity=1e3,this.planet.showed?(this.planet.setPlanet(null),this.stage.removeChild(this.planet),this.inventory.showed&&this.showInventory(),radio("objectVisitFinished").broadcast()):(this.planet.setPlanet(a),this.stage.addChild(this.planet),this.inventory.showed||this.showInventory(),radio("objectVisited").broadcast()),this.planet.showed=!this.planet.showed},Main.prototype.showInventory=function(){this.inventory.showed?(this.stage.removeChild(this.inventory),this.closeItemInfo()):this.stage.addChild(this.inventory),this.inventory.showed=!this.inventory.showed},Main.prototype.closeItemInfo=function(){this.itemInfo&&(this.stage.removeChild(this.itemInfo),this.itemInfo=null,this.universe.panel.updateCredit(),this.universe.ship.updateStats())},Main.prototype.showItemInfo=function(a,b,c){this.closeItemInfo(),a?this.itemInfo=this.planet.showed?new ItemInfo(this.itemManager,c,b,"Sell",this.inventory,this.planet):new ItemInfo(this.itemManager,c,b,"Drop",this.inventory,null):(this.itemInfo=new ItemInfo(this.itemManager,c,b,"Buy",this.planet,this.inventory),this.itemInfo.position.x+=Main.CENTER_X),this.itemInfo.onClose=this.closeItemInfo.bind(this),this.stage.addChild(this.itemInfo)},Main.prototype.showMenu=function(){this.menu.toggle()},Main.prototype.showMap=function(){this.map.showed?(this.stage.removeChild(this.map),this.closeItemInfo()):this.stage.addChild(this.map),this.map.showed=!this.map.showed},Main.prototype.restartGame=function(){this.menu.hide(),this.statistics.hide(),this.quests.hide(),localStorage.clear(),this.universe.reset(),this.inventory.reset(),this.dialogManager.reset()},Main.prototype.gameLoaded=function(){requestAnimFrame(this.update.bind(this))},Main.prototype.loadAssets=function(){this.assetsLoader=new AssetsLoader(this.renderer,this.stage),this.assetsLoader.onComplete=this.assetsLoaded.bind(this),this.assetsLoader.load()},Main.prototype.assetsLoaded=function(){this.menu=new Menu(this.stage),this.universe=new Universe,this.universe.ship.onOutOfFuel=this.outOfFuel.bind(this),this.universe.ship.onOutOfFood=this.outOfFood.bind(this),this.universe.ship.onOutOfSanity=this.outOfSanity.bind(this),this.universe.ship.onLowFuel=this.lowFuel.bind(this),this.universe.ship.onLowFood=this.lowFood.bind(this),this.universe.ship.onLowSanity=this.lowSanity.bind(this),this.universe.ship.onNormalFuel=this.normalFuel.bind(this),this.universe.ship.onNormalFood=this.normalFood.bind(this),this.universe.ship.onNormalSanity=this.normalSanity.bind(this),this.universe.panel.onVisitObject=this.visitObject.bind(this),this.universe.panel.onShowInventory=this.showInventory.bind(this),this.universe.panel.onShowMenu=this.showMenu.bind(this),this.universe.panel.onShowMap=this.showMap.bind(this),this.stage.addChild(this.universe),this.itemManager=new ItemManager,this.inventory=new Inventory(this.universe.ship,this.itemManager),this.inventory.onItemClicked=this.showItemInfo.bind(this,!0),this.dialogManager=new DialogManager(this.stage,this.inventory,this.universe.objManager),this.planet=new PlanetInventory(this.universe.ship,this.itemManager,this.dialogManager),this.planet.onItemClicked=this.showItemInfo.bind(this,!1),this.map=new Map(this.universe),this.statistics=new Statistics(this.universe.ship,this.stage),this.quests=new Quests(this.stage),this.universe.loadMap(),this.itemManager.loadItems(),this.dialogManager.loadDialogs(),this.universe.onGameLoaded=this.gameLoaded.bind(this),this.stage.removeChild(this.assetsLoader.progressBar),this.assetsLoader=null};